<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asuntojen hintakartta 2024</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * { margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; }
        #header { background: linear-gradient(135deg, #1e3c72, #2a5298); color: white; padding: 20px; }
        #stats { display: flex; gap: 15px; padding: 15px 20px; background: #f8f9fa; flex-wrap: wrap; }
        .stat-box { background: white; padding: 10px 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .stat-box .label { font-size: 12px; color: #666; }
        .stat-box .value { font-size: 20px; font-weight: bold; }
        #map { height: calc(100vh - 120px); width: 100%; }
        .legend { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .legend-item { display: flex; align-items: center; gap: 8px; margin: 5px 0; }
        .legend-color { width: 20px; height: 20px; border-radius: 3px; border: 1px solid #999; }
        .popup-content { min-width: 250px; }
        .popup-content h3 { color: #1e3c72; margin-bottom: 8px; }
        .popup-content .price { font-size: 28px; font-weight: bold; color: #27ae60; }
        .popup-content .details { margin-top: 8px; color: #666; font-size: 13px; }
        #search-box { position: absolute; top: 10px; right: 10px; z-index: 1000; background: white; padding: 10px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        #search-box input { padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; width: 200px; }
        .city-buttons { position: absolute; top: 10px; left: 10px; z-index: 1000; display: flex; gap: 5px; flex-wrap: wrap; }
        .city-buttons button { padding: 8px 15px; background: white; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
    </style>
</head>
<body>
    <div id="header">
        <h1>üè† Asuntojen keskihintakartta 2024</h1>
        <p>Vanhojen osakeasuntojen neli√∂hinnat (EUR/m¬≤) | Tilastokeskus</p>
    </div>
    <div id="stats">
        <div class="stat-box"><div class="label">Alueita</div><div class="value">770</div></div>
        <div class="stat-box"><div class="label">Keskihinta</div><div class="value">2,072 ‚Ç¨/m¬≤</div></div>
        <div class="stat-box"><div class="label">Kallein</div><div class="value" style="color: #e74c3c;">8,611 ‚Ç¨/m¬≤</div></div>
        <div class="stat-box"><div class="label">Halvin</div><div class="value" style="color: #27ae60;">307 ‚Ç¨/m¬≤</div></div>
    </div>
    <div class="city-buttons">
        <button onclick="map.setView([60.1699, 24.9384], 12)">Helsinki</button>
        <button onclick="map.setView([60.2052, 24.6566], 12)">Espoo</button>
        <button onclick="map.setView([60.2944, 24.9722], 12)">Vantaa</button>
        <button onclick="map.setView([61.4978, 23.7608], 12)">Tampere</button>
        <button onclick="map.setView([60.4518, 22.6306], 12)">Turku</button>
    </div>
    <div id="search-box"><input type="text" id="search" placeholder="Hae postinumeroa..." onkeyup="filterMap()"></div>
    <div id="map"></div>
    <div id="loading" class="loading">Ladataan karttaa...</div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        var map = L.map('map').setView([60.1699, 24.9384], 11);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {attribution: '¬© OpenStreetMap'}).addTo(map);
        
        function getColor(price) {
            if (price > 8000) return '#8B0000';
            else if (price > 6000) return '#e74c3c';
            else if (price > 5000) return '#f39c12';
            else if (price > 4000) return '#f1c40f';
            else if (price > 3000) return '#9acd32';
            else if (price > 2000) return '#27ae60';
            else return '#2ecc71';
        }
        
        var layers;
        
        fetch('postinumerot_hinnat.geojson')
            .then(response => response.json())
            .then(geojsonData => {
                document.getElementById('loading').style.display = 'none';
                
                layers = L.geoJSON(geojsonData, {
                    style: function(feature) {
                        return {
                            color: '#fff',
                            weight: 1,
                            fillColor: getColor(feature.properties.price),
                            fillOpacity: 0.7
                        };
                    },
                    onEachFeature: function(feature, layer) {
                        layer.bindPopup(
                            '<div class="popup-content">' +
                            '<h3>' + feature.properties.postcode + '</h3>' +
                            '<div class="price">' + feature.properties.price.toLocaleString() + ' ‚Ç¨/m¬≤</div>' +
                            '<div class="details">' + feature.properties.name + '</div>' +
                            '</div>'
                        );
                        layer.postcode = feature.properties.postcode;
                    }
                }).addTo(map);
                
                var legend = L.control({position: 'bottomright'});
                legend.onAdd = function(map) {
                    var div = L.DomUtil.create('div', 'legend');
                    div.innerHTML = '<b>‚Ç¨/m¬≤</b><br>';
                    var grades = [0, 2000, 3000, 4000, 5000, 6000, 8000];
                    var labels = ['<2000', '2000-3000', '3000-4000', '4000-5000', '5000-6000', '6000-8000', '>8000'];
                    for (var i = 0; i < grades.length; i++) {
                        div.innerHTML += '<div class="legend-item"><div class="legend-color" style="background:'+getColor(grades[i]+1)+'"></div>'+labels[i]+'</div>';
                    }
                    return div;
                };
                legend.addTo(map);
            })
            .catch(error => {
                console.error('Error loading GeoJSON:', error);
                document.getElementById('loading').textContent = 'Virhe ladattaessa karttaa';
            });
        
        function filterMap() {
            if (!layers) return;
            var query = document.getElementById('search').value.toLowerCase();
            layers.eachLayer(function(layer) {
                var show = query === '' || layer.postcode.includes(query);
                if (show) {
                    layer.setStyle({opacity: 1, fillOpacity: 0.7});
                } else {
                    layer.setStyle({opacity: 0.1, fillOpacity: 0.05});
                }
            });
        }
    </script>
</body>
</html>